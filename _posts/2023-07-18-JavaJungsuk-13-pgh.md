---
layout: post
title: "[13챕터] 쓰레드의 우선순위"
subtitle: 자바의 정석 스터디 20회차
categories: Java
tags: [java, 자바의정석, 쓰레드, 우선순위]
---

## 쓰레드의 우선순위

### 쓰레드(Thread)
일단 쓰레드라는 것을 알아보기 전에 프로세스라는 것이 간략하게 무엇인지 알아야 한다.<br/>
프로세스란, 실행 중인 프로그램을 뜻한다. 그리고 그에 대한 구성으로 메모리, 데이터등의 자원과 쓰레드가 있다.<br/>
여기서 쓰레드라는 개념이 쓰이는데 이는 프로세스의 자원으로 실 작업을 수행하는 것을 의미한다.

쓰레드는 다음과 같은 특징을 지니고 있다.
- 모든 프로세스는 최소 하나 이상의 쓰레드가 존재.
- 하나의 프로세스가 가질 수 있는 쓰레드의 개수는 제한이 없다.
- 쓰레드가 작업을 수행하는데 Call Stack을 필요로 하며 이는 프로세스의 메모리 한계와 관련이 있다.

### 우선순위
Java에서는 Thread와 관련된 메서드를 제공해준다. 그 중 우선순위와 관련된 기능이 존재한다.
```java
// 쓰레드의 우선순위와 관련된 상수 값
public static final int MAX_PRIORITY = 10; // 최대 우선순위
public static final int NORM_PRIORITY = 5; // 평균 우선순위
public static final int MIN_PRIORITY = 1; // 최소 우선순위

// 지정한 쓰레드의 우선순위를 지정한 값으로 변경 (우선순위의 범위: 1~10)
void setPriority(int newPriority);

// 쓰레드의 우선순위를 반환
int getPriority();
```
#### 특징
- 숫자가 높을수록 우선순위는 높아진다.
- main 메서드는 우선순위가 5다.
- 쓰레드의 우선순위는 쓰레드를 생성한 쓰레드로부터 상속받는다.

우선순위가 높아지면 무슨 일이 벌어지는가?
- 쓰레드의 우선순위가 상대적으로 높으면 더 많은 양의 실행시간과 기회가 주어진다.
- 다만 무조건 그런 것은 아니다. 빨리 완료되거나 그럴 수 있지만 아닐 수도 있다. 이는 OS의 스케쥴링 때문이다.
- 작업을 빨리 끝내고 싶으면 PriorityQueue에 작업의 우선순위를 저장하여 처리하는 것이 낫다.

### 스케줄링
- 메모리에 적재된 프로그램을 CPU가 실행할 수 있게 쓰레드에 CPU를 할당하는 것.
- 큐에서 하나의 프로세스를 선택해 CPU를 할당하는 디스패처가 존재한다.
- 프로세스를 선택하는 기준과 순서에 따라 결정하는 방법인 정책에 따라 종류가 다르다.
- 위에 적었듯이 운영체제에 따라 다르다.

<br/>
크게는 프로세스의 실행권을 누가 가지고 있느냐에 따라 2가지로 나뉘고 그 이후로 여러 개로 나뉘어진다.
<br/>

#### 선점 스케줄링
실행중인 프로세스가 강제적으로 빼앗기고 다른 프로세스가 실행되는 방식의 스케줄링을 의미한다. <br/>
대표적으로는 Round-Robin, 선점 우선순위, 다단계 큐 스케줄링, 다단계 피드백 큐 스케줄링 등이 있다.

- Round-Robin: 원형 큐에 프로세스를 두어 일정한 시간을 가지고 각 프로세스를 돌아가며 실행하는 구조. 할당하는 시간의 양에 따라서 장단점이 존재한다.
- 선점 우선순위: 우선순위가 높은 순서대로 번갈아가며 일을 할당받는 구조. 우선순위가 바뀌면 실행권을 잃고 더 높은 우선순위로 전환이 된다.
- 다단계 큐 스케줄링: 우선순위마다 큐를 형성하고 항상 가장 높은 우선순위의 큐의 프로세스에 CPU를 할당하는 구조. 각 큐는 Round-Robin이나 FCFS 등 독자적인 스케줄링이 사용 가능하다.
낮은 우선순위의 큐를 작업하다 높은 우선순위의 프로세스가 큐에 도착하면 실행권을 빼앗는다.
- 다단계 피드백 큐 스케줄링: 프로세스 생성 시 가장 높은 우선 순위 준비 큐에 등록되고 각 큐는 FCFS로 실행되는 구조. 시간 할당량이 있어 시간이 끝나면 다음 우선순위의 큐를 실행한다.

우선순위가 낮을수록 시간 할당량이 증가되고 큐 사이에서 프로세스가 이동이 가능한 것이 다단계 큐와 큰 차이점이다. 가장 하위 큐에서는 시간이 오래걸리면 다시 상위 큐로 이동한다.

#### 비선점 스케줄링
선점한 프로세스가 자발적으로 실행권을 내려놓는 방식의 스케줄링을 의미한다.
대표적으로는 FCFS, SJF, 우선순위 등이 있다.

- FCFS(First-Come First-Served): CPU를 먼저 요청하는 프로세스가 CPU를 먼저 할당받는 구조. 일이 끝나면 다음 프로세를 받는다. 긴 작업이 먼저 올 경우, 짧은 작업이 기다리는 경우가 발생한다.
- SJF(Shortest-Job-First): 최단 작업 우선으로 가장짧은 시간이 걸리는 프로세스부터 할당받는 구조. 다만 이는 걸리는 작업 시간을 미리 알아야 하기 때문에 현실성이 많지 않다.
- 우선순위: 각 프로세스에 우선순위를 두고 가장 높은 우선순위를 가진 프로세스부터 할당된다. 우선순위 낮은 프로세스들은 무한히 갇힐 수 있는 기아상태에 빠질 수 있다.
